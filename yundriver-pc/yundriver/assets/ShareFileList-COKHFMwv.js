import{_ as Ie,r,G as ke,o as Ce,E as d,H as be,c as v,b as s,d as l,t as I,l as p,w as o,x as m,I as q,B as we,h as xe,e as c,f as n,a8 as Se,g as f,K as Fe,z as Ne,L as ze,M as Te,N as Be,O as $e,P as Ve,Q as Ee,R as Le,a2 as J,ab as qe}from"./index-xsXBKXXp.js";import{_ as Me}from"./logo-Dp76uQSX.js";import{h as We,i as Pe,b as D,e as je}from"./file-DWF0CrJu.js";import{F as De}from"./FilePreview-znKgSkON.js";function Q(z){if(z===0)return"0 B";const u=1024,T=["B","KB","MB","GB","TB"],_=Math.floor(Math.log(z)/Math.log(u));return(z/Math.pow(u,_)).toFixed(2)+" "+T[_]}const Ue={class:"share-page"},Re={class:"header"},Oe={class:"share-info"},Ae={class:"share-user"},Ke={class:"share-time"},Ge={class:"breadcrumb"},He={class:"action-bar"},Je={class:"left"},Qe={class:"main-content"},Xe={class:"content-area"},Ye={class:"table-container"},Ze={key:0,class:"file-list"},et=["onClick"],tt={class:"file-name"},at={key:0},lt={key:1},ot={class:"pagination"},st={key:1,class:"empty-state"},nt={class:"folder-tree"},rt={class:"dialog-footer"},it={__name:"ShareFileList",setup(z){const u=we(),T=xe(),_=r([]),M=r(0),y=r(1),k=r(10),B=r({}),$=r("0"),C=r([]),W=r(!1),U=r(null),b=r(!1),g=r([]),w=r(!1),V=r(null),x=r(""),R=r([]),E=r({}),P=r(!1),S=async()=>{try{if($.value==="0"){const t=await We({fileIds:u.query.fileIds,userId:u.query.userId,page:y.value,pageSize:k.value});t.code===1&&(_.value=t.data.rows,M.value=t.data.total)}else{const t=await Pe({filePid:$.value,userId:u.query.userId,page:y.value,pageSize:k.value});t.code===1&&(_.value=t.data.rows,M.value=t.data.total)}}catch(t){console.error("获取文件列表失败:",t),d.error("获取文件列表失败")}},X=t=>{if(t.folderType===1)C.value.push({fileId:t.fileId,fileName:t.fileName}),$.value=t.fileId,y.value=1,S();else{const e=Y(t);if(e===0){d.info("该文件类型暂不支持预览");return}U.value={...t,fileType:e,isVideo:e===1,userId:u.query.userId,previewUrl:`/api/file/getFile?fileId=${t.fileId}&userId=${u.query.userId}`,videoInfoUrl:e===1?`/api/file/ts/getVideoInfo?fileId=${t.fileId}&userId=${u.query.userId}`:void 0},W.value=!0}},Y=t=>{if(t.fileCategory===1)return 1;if(t.fileCategory===2)return 2;if(t.fileCategory===3)return 3;const e=t.fileName.toLowerCase();return e.endsWith(".pdf")?4:e.endsWith(".doc")||e.endsWith(".docx")?5:e.endsWith(".xls")||e.endsWith(".xlsx")?6:e.endsWith(".txt")||e.endsWith(".md")?7:Z(e)?8:0},Z=t=>[".js",".ts",".java",".py",".cpp",".c",".h",".html",".css",".scss",".less",".json",".xml"].some(i=>t.toLowerCase().endsWith(i)),O=(t,e)=>{t==="0"?C.value=[]:C.value=C.value.slice(0,e+1),$.value=t,y.value=1,S()},ee=async t=>{if(!P.value)try{P.value=!0;const e=`http://114.132.59.198:8081/api/file/download?fileIds=${t.fileId}&userId=${u.query.userId}`;window.open(e,"_blank"),d.success("下载成功")}catch(e){console.error("下载失败:",e),d.error("下载失败")}finally{P.value=!1}},te=t=>{k.value=t,S()},ae=t=>{y.value=t,S()},le=t=>[".doc",".docx",".xls",".xlsx",".ppt",".pptx",".pdf",".txt"].some(i=>t.toLowerCase().endsWith(i)),oe=t=>[".jpg",".jpeg",".png",".gif",".bmp"].some(i=>t.toLowerCase().endsWith(i)),se=t=>{d.info("该文件类型暂不支持预览")},ne=()=>{b.value=!0},A=()=>{b.value=!1,g.value=[]},re=t=>{g.value=t},ie=()=>{if(g.value.length===0){d.warning("请选择要下载的文件");return}const t=g.value.filter(e=>!e.folderType).map(e=>e.fileId).join(",");if(t){const e=`http://114.132.59.198:8081/api/file/download?fileIds=${t}&userId=${u.query.userId}`;window.open(e,"_blank")}else d.warning("没有可下载的文件")},de=async(t,e)=>{try{if(t.level===0){const F=await D("-1");if(F.code===1){const j={fileId:"0",fileName:"全部文件",children:F.data};e([j])}else e([{fileId:"0",fileName:"全部文件",children:[]}]);return}const i=await D(t.data.fileId);i.code===1&&i.data?e(i.data):e([])}catch(i){console.error("加载文件夹失败:",i),d.error("加载文件夹失败"),e([])}},ue=t=>{x.value=t.fileId},K=async t=>{if(R.value=Array.isArray(t)?t:[t],w.value=!0,x.value="",V.value){V.value.setCurrentKey(null);try{const e=await D("-1");if(e.code===1){const i={fileId:"0",fileName:"全部文件",children:e.data};V.value.setData([i])}}catch(e){console.error("加载文件夹失败:",e),d.error("加载文件夹失败")}}},ce=async()=>{if(!x.value){d.warning("请选择保存位置");return}try{const t=R.value.map(e=>e.fileId).join(",");await qe({fileIds:t,filePid:x.value,userId:u.query.userId}),d.success("保存成功"),w.value=!1,b.value&&A()}catch(t){console.error("保存失败:",t),d.error("保存失败")}},fe=t=>{K(t)},pe=()=>{if(g.value.length===0){d.warning("请选择要保存的文件");return}K(g.value)},ve=async t=>{try{const e=await je(t,2);e.code===1&&(E.value[t]=e.data)}catch(e){console.error("获取文件夹大小失败:",e)}};return ke(()=>_.value,t=>{t.forEach(e=>{e.folderType===1&&E.value[e.fileId]===void 0&&ve(e.fileId)})},{immediate:!0}),Ce(()=>{if(!u.query.fileIds||!u.query.userId){d.error("分享信息不完整"),T.push("/");return}const t=localStorage.getItem("shareInfo");if(t)B.value=JSON.parse(t);else{d.error("分享信息不完整"),T.push("/");return}S()}),be(()=>{localStorage.removeItem("shareInfo")}),(t,e)=>{const i=c("el-avatar"),F=c("el-breadcrumb-item"),j=c("el-breadcrumb"),h=c("el-button"),G=c("el-button-group"),N=c("el-table-column"),H=c("el-icon"),me=c("el-table"),_e=c("el-pagination"),ge=c("el-empty"),he=c("el-tree"),ye=c("el-dialog");return n(),v("div",Ue,[s("div",Re,[e[6]||(e[6]=s("div",{class:"logo-container"},[s("img",{src:Me,alt:"logo",class:"logo"}),s("span",{class:"logo-text"},"在线网盘")],-1)),s("div",Oe,[l(i,{size:32,src:B.value.avatar,class:"share-avatar"},null,8,["src"]),s("span",Ae,I(B.value.userName),1),s("span",Ke,"分享于 "+I(p(Se)(B.value.shareTime)),1)])]),s("div",Ge,[l(j,{separator:"/"},{default:o(()=>[l(F,{onClick:e[0]||(e[0]=a=>O("0"))},{default:o(()=>e[7]||(e[7]=[f("全部文件")])),_:1}),(n(!0),v(q,null,Fe(C.value,(a,L)=>(n(),m(F,{key:a.fileId,onClick:dt=>O(a.fileId,L)},{default:o(()=>[f(I(a.fileName),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),s("div",He,[s("div",Je,[b.value?(n(),v(q,{key:1},[l(G,null,{default:o(()=>[l(h,{type:"primary",size:"large",onClick:pe,disabled:!g.value.length},{default:o(()=>e[9]||(e[9]=[f(" 批量保存到网盘 ")])),_:1},8,["disabled"]),l(h,{type:"primary",size:"large",onClick:ie,disabled:!g.value.length},{default:o(()=>e[10]||(e[10]=[f(" 批量下载 ")])),_:1},8,["disabled"])]),_:1}),l(h,{size:"large",onClick:A},{default:o(()=>e[11]||(e[11]=[f(" 取消操作 ")])),_:1})],64)):(n(),m(h,{key:0,size:"large",onClick:ne},{default:o(()=>e[8]||(e[8]=[f("批量操作")])),_:1}))])]),s("div",Qe,[s("div",Xe,[s("div",Ye,[_.value.length>0?(n(),v("div",Ze,[l(me,{data:_.value,style:{width:"100%"},onSelectionChange:re},{default:o(()=>[b.value?(n(),m(N,{key:0,type:"selection",width:"55"})):Ne("",!0),l(N,{label:"文件名","min-width":"400"},{default:o(({row:a})=>[s("div",{class:"file-name-cell",onClick:L=>X(a)},[l(H,{size:20,class:"file-icon"},{default:o(()=>[a.folderType===1?(n(),m(p(ze),{key:0})):le(a.fileName)?(n(),m(p(Te),{key:1})):a.fileCategory===1?(n(),m(p(Be),{key:2})):a.fileCategory===2?(n(),m(p($e),{key:3})):oe(a.fileName)?(n(),m(p(Ve),{key:4})):(n(),m(p(Ee),{key:5}))]),_:2},1024),s("span",tt,I(a.fileName),1)],8,et)]),_:1}),l(N,{prop:"fileSize",label:"大小",width:"150"},{default:o(({row:a})=>[a.folderType===1?(n(),v(q,{key:0},[E.value[a.fileId]!==void 0?(n(),v("span",at,I(p(Q)(E.value[a.fileId])),1)):(n(),v("span",lt,[l(H,{class:"is-loading"},{default:o(()=>[l(p(Le))]),_:1})]))],64)):(n(),v(q,{key:1},[f(I(p(Q)(a.fileSize)),1)],64))]),_:1}),l(N,{prop:"lastUpdateTime",label:"修改时间",width:"200"}),l(N,{label:"操作",width:"200",fixed:"right"},{default:o(({row:a})=>[l(G,null,{default:o(()=>[l(h,{type:"primary",link:"",onClick:J(L=>fe(a),["stop"])},{default:o(()=>e[12]||(e[12]=[f(" 保存到网盘 ")])),_:2},1032,["onClick"]),l(h,{type:"primary",link:"",onClick:J(L=>ee(a),["stop"])},{default:o(()=>e[13]||(e[13]=[f(" 下载 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"]),s("div",ot,[l(_e,{"current-page":y.value,"onUpdate:currentPage":e[1]||(e[1]=a=>y.value=a),"page-size":k.value,"onUpdate:pageSize":e[2]||(e[2]=a=>k.value=a),total:M.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:te,onCurrentChange:ae},null,8,["current-page","page-size","total"])])])):(n(),v("div",st,[l(ge,{description:"暂无文件"})]))])])]),l(De,{modelValue:W.value,"onUpdate:modelValue":e[3]||(e[3]=a=>W.value=a),file:U.value,onPreviewError:se},null,8,["modelValue","file"]),l(ye,{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=a=>w.value=a),title:"选择保存位置",width:"500px"},{footer:o(()=>[s("span",rt,[l(h,{onClick:e[4]||(e[4]=a=>w.value=!1)},{default:o(()=>e[14]||(e[14]=[f("取消")])),_:1}),l(h,{type:"primary",onClick:ce,disabled:!x.value},{default:o(()=>e[15]||(e[15]=[f(" 确定 ")])),_:1},8,["disabled"])])]),default:o(()=>[s("div",nt,[l(he,{ref_key:"folderTreeRef",ref:V,data:[{fileId:"0",fileName:"全部文件",children:[]}],"node-key":"fileId",props:{label:"fileName",children:"children"},load:de,lazy:"","highlight-current":"","default-expanded-keys":["0"],onNodeClick:ue},null,512)])]),_:1},8,["modelValue"])])}}},vt=Ie(it,[["__scopeId","data-v-0a887a4b"]]);export{vt as default};
