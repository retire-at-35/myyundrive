import{_ as x}from"./logo-Dp76uQSX.js";import{_ as L,u as R,r as p,a as B,o as q,c as E,b as r,d as t,w as l,e as n,f as F,g as f,h as I,E as d}from"./index-xsXBKXXp.js";import{g as N,l as j,m as M}from"./md5-DKd9LonJ.js";const S={class:"auth-container"},O={class:"auth-box"},T={class:"verify-code-container"},z={class:"verify-code-img"},A=["src"],D={class:"operation-links"},G={__name:"Login",setup(H){const y=I(),w=R(),m=p(!1),_=p(null),g=p(""),s=B({email:"",password:"",verifyCode:""}),C={email:[{required:!0,message:"请输入账号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],verifyCode:[{required:!0,message:"请输入验证码",trigger:"blur"}]},b=async()=>{try{const a=await N(1),e=new Blob([a],{type:"image/jpeg"});return URL.createObjectURL(e)}catch(a){return console.error("获取验证码失败:",a),""}},u=async()=>{const a=await b();g.value=a};q(()=>{u()});const V=async()=>{var a,e;try{await _.value.validate(),m.value=!0;const o=await j({email:s.email,password:M(s.password),checkCode:s.verifyCode});o.code===1?(await w.setUserInfo(o.data),d.success("登录成功"),y.push("/home")):(d.error(o.data),u(),s.verifyCode="")}catch(o){(e=(a=o==null?void 0:o.response)==null?void 0:a.data)!=null&&e.msg?d.error(o.response.data.msg):o!=null&&o.message?d.error(o.message):d.error("登录失败，请稍后重试"),u(),s.verifyCode=""}finally{m.value=!1}};return(a,e)=>{const o=n("el-input"),c=n("el-form-item"),h=n("el-button"),v=n("router-link"),k=n("el-form"),U=n("el-card");return F(),E("div",S,[r("div",O,[t(U,{class:"auth-card"},{default:l(()=>[e[6]||(e[6]=r("div",{class:"header"},[r("img",{src:x,class:"logo",alt:"logo"}),r("h2",{class:"title"},"用户登录"),r("p",{class:"subtitle"},"欢迎使用云存储平台")],-1)),t(k,{model:s,rules:C,ref_key:"loginFormRef",ref:_,class:"auth-form"},{default:l(()=>[t(c,{prop:"email"},{default:l(()=>[t(o,{modelValue:s.email,"onUpdate:modelValue":e[0]||(e[0]=i=>s.email=i),placeholder:"请输入账号","prefix-icon":"User"},null,8,["modelValue"])]),_:1}),t(c,{prop:"password"},{default:l(()=>[t(o,{modelValue:s.password,"onUpdate:modelValue":e[1]||(e[1]=i=>s.password=i),type:"password",placeholder:"请输入密码","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),t(c,{prop:"verifyCode"},{default:l(()=>[r("div",T,[t(o,{modelValue:s.verifyCode,"onUpdate:modelValue":e[2]||(e[2]=i=>s.verifyCode=i),placeholder:"请输入验证码",class:"verify-code-input"},null,8,["modelValue"]),r("div",z,[r("img",{src:g.value,alt:"验证码",onClick:u},null,8,A)])])]),_:1}),t(c,null,{default:l(()=>[t(h,{type:"primary",class:"submit-button",loading:m.value,onClick:V},{default:l(()=>e[3]||(e[3]=[f(" 登录 ")])),_:1},8,["loading"])]),_:1}),r("div",D,[t(v,{to:"/register",replace:""},{default:l(()=>e[4]||(e[4]=[f("注册账号")])),_:1}),t(v,{to:"/forgot-password",replace:""},{default:l(()=>e[5]||(e[5]=[f("忘记密码？")])),_:1})])]),_:1},8,["model"])]),_:1}),e[7]||(e[7]=r("div",{class:"footer"},[r("p")],-1))])])}}},Q=L(G,[["__scopeId","data-v-d7bca147"]]);export{Q as default};
