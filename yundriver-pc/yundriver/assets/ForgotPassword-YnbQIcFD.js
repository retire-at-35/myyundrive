import{_ as D,a as M,r as d,o as N,c as O,b as r,d as o,w as a,e as n,f as $,g as v,t as R,h as T,E as g}from"./index-xsXBKXXp.js";import{a as K,m as A,g as G}from"./md5-DKd9LonJ.js";import{s as H}from"./email-Sb9TfbaC.js";const J={class:"auth-container"},Q={class:"auth-box"},W={class:"email-container"},X={class:"verify-code-container"},Y={class:"verify-code-img"},Z=["src"],ee={class:"operation-links"},oe={class:"verify-dialog-content"},le={class:"verify-input-container"},ae={class:"verify-img"},se=["src"],re={class:"dialog-footer"},te={__name:"ForgotPassword",setup(ie){const L=T(),l=M({email:"",emailCode:"",newPassword:"",confirmPassword:"",verifyCode:""}),_=d(60),C=d(!1),V=d("发送验证码");let P=null;const m=d(!1),c=d(""),y=d(""),w=d(""),U={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],emailCode:[{required:!0,message:"请输入邮箱验证码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(i,e,t)=>{e!==l.newPassword?t(new Error("两次输入的密码不一致")):t()},trigger:"blur"}],verifyCode:[{required:!0,message:"请输入验证码",trigger:"blur"}]},b=d(null),E=()=>{C.value=!0,P=setInterval(()=>{_.value>0?(_.value--,V.value=`${_.value}秒后重试`):(clearInterval(P),C.value=!1,V.value="发送验证码",_.value=60)},1e3)},q=async()=>{if(U.email[1],!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email)){g.error("请输入正确的邮箱格式");return}c.value="",m.value=!0,x()},f=d(!1),B=async()=>{if(!c.value){g.error("请输入验证码");return}try{f.value=!0,await H({email:l.email,checkCode:c.value,type:1}),m.value=!1,g.success("验证码已发送到邮箱"),E()}catch{x(),g.error("验证码发送失败,请重试")}finally{f.value=!1}},F=async()=>{b.value&&await b.value.validate(async i=>{if(i)try{await K({email:l.email,password:A(l.newPassword),emailCode:l.emailCode,checkCode:l.verifyCode}),g.success("重置密码成功"),L.replace("/login")}catch{k(),l.verifyCode=""}})},h=async i=>{try{const e=await G(i);i===1&&y.value?URL.revokeObjectURL(y.value):i===0&&w.value&&URL.revokeObjectURL(w.value);const t=new Blob([e],{type:"image/jpeg"});return URL.createObjectURL(t)}catch(e){return console.error("获取验证码失败:",e),""}},k=async()=>{y.value=await h(1)},x=async()=>{w.value=await h(0)};return N(()=>{k()}),(i,e)=>{const t=n("el-input"),p=n("el-button"),u=n("el-form-item"),S=n("router-link"),j=n("el-form"),I=n("el-card"),z=n("el-dialog");return $(),O("div",J,[r("div",Q,[o(I,{class:"auth-card"},{default:a(()=>[e[10]||(e[10]=r("h2",{class:"title"},"找回密码",-1)),o(j,{model:l,rules:U,ref_key:"forgotFormRef",ref:b},{default:a(()=>[o(u,{prop:"email"},{default:a(()=>[r("div",W,[o(t,{modelValue:l.email,"onUpdate:modelValue":e[0]||(e[0]=s=>l.email=s),placeholder:"请输入邮箱","prefix-icon":"Message",class:"email-input"},null,8,["modelValue"]),o(p,{type:"primary",disabled:C.value,onClick:q,style:{width:"120px",padding:"8px 0","font-size":"13px"}},{default:a(()=>[v(R(V.value),1)]),_:1},8,["disabled"])])]),_:1}),o(u,{prop:"emailCode"},{default:a(()=>[o(t,{modelValue:l.emailCode,"onUpdate:modelValue":e[1]||(e[1]=s=>l.emailCode=s),placeholder:"请输入邮箱验证码","prefix-icon":"Key"},null,8,["modelValue"])]),_:1}),o(u,{prop:"newPassword"},{default:a(()=>[o(t,{modelValue:l.newPassword,"onUpdate:modelValue":e[2]||(e[2]=s=>l.newPassword=s),type:"password",placeholder:"请输入新密码","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),o(u,{prop:"confirmPassword"},{default:a(()=>[o(t,{modelValue:l.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=s=>l.confirmPassword=s),type:"password",placeholder:"请确认新密码","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),o(u,{prop:"verifyCode"},{default:a(()=>[r("div",X,[o(t,{modelValue:l.verifyCode,"onUpdate:modelValue":e[4]||(e[4]=s=>l.verifyCode=s),placeholder:"请输入验证码",class:"verify-code-input"},null,8,["modelValue"]),r("div",Y,[r("img",{src:y.value,alt:"验证码",onClick:k},null,8,Z)])])]),_:1}),o(u,null,{default:a(()=>[o(p,{type:"primary",class:"submit-button",onClick:F},{default:a(()=>e[8]||(e[8]=[v(" 重置密码 ")])),_:1})]),_:1}),r("div",ee,[o(S,{to:"/login",replace:""},{default:a(()=>e[9]||(e[9]=[v("返回登录")])),_:1})])]),_:1},8,["model"])]),_:1}),o(z,{modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=s=>m.value=s),title:"安全验证",width:"360px",center:"","close-on-click-modal":!1,class:"verify-dialog"},{footer:a(()=>[r("div",re,[o(p,{onClick:e[6]||(e[6]=s=>m.value=!1),size:"default"},{default:a(()=>e[11]||(e[11]=[v("取消")])),_:1}),o(p,{type:"primary",onClick:B,loading:f.value,disabled:f.value,size:"default"},{default:a(()=>[v(R(f.value?"发送中...":"确认"),1)]),_:1},8,["loading","disabled"])])]),default:a(()=>[r("div",oe,[r("div",le,[o(t,{modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=s=>c.value=s),placeholder:"请输入验证码",class:"verify-input"},null,8,["modelValue"]),r("div",ae,[r("img",{src:w.value,alt:"验证码",onClick:x},null,8,se)])])])]),_:1},8,["modelValue"]),e[12]||(e[12]=r("div",{class:"footer"},null,-1))])])}}},me=D(te,[["__scopeId","data-v-ee66d1db"]]);export{me as default};
