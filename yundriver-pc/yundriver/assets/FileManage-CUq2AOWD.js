import{_ as A,r as i,j as H,o as J,c as K,b as _,d as l,w as o,a5 as O,x as u,z as Q,E as c,e as d,a6 as q,f as r,l as n,J as G,g as f,M as R,N as X,O as Y,P as Z,Q as ee,t as w,a8 as te,k as ae}from"./index-xsXBKXXp.js";import{i as le,a as oe,f as ne}from"./file-BhbL9qfw.js";import{b as se,d as ie,c as re}from"./admin-C8agBfjW.js";import{F as ue}from"./FilePreview-znKgSkON.js";import"./file-DWF0CrJu.js";const de={class:"file-manage"},ce={class:"search-bar"},fe={class:"table-container"},pe=["onClick"],me={class:"file-name"},ve={class:"pagination"},_e={__name:"FileManage",setup(ge){const s=i(!1),x=i([]),p=i(1),g=i(10),F=i(0),h=i(""),b=i(!1),k=i(null),N=H(()=>"calc(100vh - 280px)"),m=async()=>{s.value=!0;try{const t=await se({page:p.value,pageSize:g.value,fileName:h.value});t.code===1&&(x.value=t.data.rows,F.value=t.data.total)}catch(t){console.error("获取文件列表失败:",t),c.error("获取文件列表失败")}finally{s.value=!1}},z=()=>{p.value=1,m()},V=()=>{h.value="",z()},S=t=>{const e=E(t);if(e===0){c.info("该文件类型暂不支持预览");return}k.value={...t,fileType:e,isVideo:e===1,previewUrl:`/api/file/getFile?fileId=${t.fileId}`,videoInfoUrl:e===1?`/api/file/ts/getVideoInfo?fileId=${t.fileId}`:void 0},b.value=!0},U=async t=>{if(!s.value)try{s.value=!0,await ie(t.userId,t.fileId),c.success("下载成功")}catch(e){console.error("下载失败:",e),c.error("下载失败")}finally{s.value=!1}},W=async t=>{try{await ae.confirm("确定要删除该文件吗？此操作不可恢复！","警告",{type:"warning",confirmButtonText:"删除",confirmButtonClass:"el-button--danger"}),s.value=!0,(await re(t.userId,t.fileId)).code===1&&(c.success("删除成功"),m())}catch(e){e!=="cancel"&&(console.error("删除文件失败:",e),c.error("删除文件失败"))}finally{s.value=!1}},B=t=>{g.value=t,m()},D=t=>{p.value=t,m()},E=t=>{if(t.fileCategory===1)return 1;if(t.fileCategory===2)return 2;if(t.fileCategory===3)return 3;const e=t.fileName.toLowerCase();return e.endsWith(".pdf")?4:e.endsWith(".doc")||e.endsWith(".docx")?5:e.endsWith(".xls")||e.endsWith(".xlsx")?6:e.endsWith(".txt")||e.endsWith(".md")?7:M(e)?8:0},M=t=>[".js",".ts",".java",".py",".cpp",".c",".h",".html",".css",".scss",".less",".json",".xml"].some(y=>t.toLowerCase().endsWith(y));return J(()=>{m()}),(t,e)=>{const y=d("el-icon"),T=d("el-input"),C=d("el-button"),v=d("el-table-column"),j=d("el-button-group"),L=d("el-table"),P=d("el-pagination"),$=q("loading");return r(),K("div",de,[_("div",ce,[l(T,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),placeholder:"输入文件名搜索",class:"search-input",clearable:""},{prefix:o(()=>[l(y,null,{default:o(()=>[l(n(G))]),_:1})]),_:1},8,["modelValue"]),l(C,{type:"primary",onClick:z},{default:o(()=>e[4]||(e[4]=[f("搜索")])),_:1}),l(C,{onClick:V},{default:o(()=>e[5]||(e[5]=[f("重置")])),_:1})]),_("div",fe,[O((r(),u(L,{data:x.value,style:{width:"100%"},height:N.value},{default:o(()=>[l(v,{label:"文件名","min-width":"300"},{default:o(({row:a})=>[_("div",{class:"file-name-cell",onClick:I=>S(a)},[l(y,{size:20,class:"file-icon"},{default:o(()=>[n(le)(a.fileName)?(r(),u(n(R),{key:0})):a.fileCategory===1?(r(),u(n(X),{key:1})):a.fileCategory===2?(r(),u(n(Y),{key:2})):n(oe)(a.fileName)?(r(),u(n(Z),{key:3})):(r(),u(n(ee),{key:4}))]),_:2},1024),_("span",me,w(a.fileName),1)],8,pe)]),_:1}),l(v,{prop:"email",label:"所属用户",width:"200","show-overflow-tooltip":""}),l(v,{prop:"fileSize",label:"大小",width:"120"},{default:o(({row:a})=>[f(w(n(ne)(a.fileSize)),1)]),_:1}),l(v,{prop:"lastUpdateTime",label:"上传时间",width:"180"},{default:o(({row:a})=>[f(w(n(te)(a.lastUpdateTime)),1)]),_:1}),l(v,{label:"操作",width:"150",fixed:"right"},{default:o(({row:a})=>[l(j,null,{default:o(()=>[l(C,{type:"primary",link:"",onClick:I=>U(a)},{default:o(()=>e[6]||(e[6]=[f(" 下载 ")])),_:2},1032,["onClick"]),l(C,{type:"danger",link:"",onClick:I=>W(a)},{default:o(()=>e[7]||(e[7]=[f(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","height"])),[[$,s.value]])]),_("div",ve,[l(P,{"current-page":p.value,"onUpdate:currentPage":e[1]||(e[1]=a=>p.value=a),"page-size":g.value,"onUpdate:pageSize":e[2]||(e[2]=a=>g.value=a),total:F.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:B,onCurrentChange:D},null,8,["current-page","page-size","total"])]),k.value?(r(),u(ue,{key:0,modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=a=>b.value=a),file:k.value},null,8,["modelValue","file"])):Q("",!0)])}}},we=A(_e,[["__scopeId","data-v-2f54e663"]]);export{we as default};
