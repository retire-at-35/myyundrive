import{i as D,_ as se,r as u,G as ie,o as re,H as ce,c as v,b as r,d as a,x as k,w as n,I as x,E as g,e as c,f as o,g as d,l as S,J as ue,z as de,a1 as P,t as R,R as fe,a2 as E,L as pe,N as ve,O as _e,P as me,M as ge,Q as ye}from"./index-xsXBKXXp.js";import{f as j}from"./file-BhbL9qfw.js";import{e as he}from"./file-DWF0CrJu.js";function Ce(f){return D({url:"/api/recycle/loadRecycleFileList",method:"get",params:{fileName:f.fileName||"",page:f.page||1,pageSize:f.pageSize||10}})}function ke(f){return D({url:"/api/recycle/recoverFile",method:"put",params:{fileIds:f}})}function be(f){return D({url:"/api/recycle/deleteFile",method:"delete",params:{fileIds:f}})}const ze={class:"page-container"},we={class:"notice-bar"},Se={class:"action-bar"},Fe={class:"left"},Ie={class:"search"},Te={class:"content-area"},Re={class:"table-container"},Ve={key:0,class:"file-list"},xe={class:"file-name-cell"},De={class:"file-name"},Ne={key:0},Ue={key:1},Be={class:"pagination"},Le={key:1,class:"empty-state"},$e={class:"dialog-footer"},Me={__name:"Recycle",props:{updateUserSpace:{type:Function,required:!0}},setup(f){const N=f,F=u([]),b=u(1),I=u(10),U=u(0),V=u(""),_=u(!1),s=u([]),z=u(!1),w=u(null),T=u({}),O="http://114.132.59.198:8081",y=async()=>{try{const t=await Ce({fileName:V.value,page:b.value,pageSize:I.value});if(t.data){const e=t.data.rows,p=e.filter(i=>i.filePid==="0"?!0:!e.some(h=>h.fileId===i.filePid));F.value=p,U.value=p.length}}catch(t){console.error("获取回收站文件列表失败:",t),g.error("获取回收站文件列表失败")}},B=()=>{w.value&&clearTimeout(w.value),w.value=setTimeout(()=>{b.value=1,y()},300)},A=t=>{I.value=t,y()},q=t=>{b.value=t,y()},G=()=>{_.value=!0},H=()=>{_.value=!1,s.value=[]},J=t=>{s.value=t},L=async t=>{try{const e=t.map(p=>p.fileId).join(",");await ke(e),g.success("恢复成功"),await y(),await N.updateUserSpace(),_.value&&(_.value=!1,s.value=[])}catch(e){console.error("恢复失败:",e),g.error("恢复失败")}},K=async()=>{try{const t=s.value.map(e=>e.fileId).join(",");await be(t),g.success("删除成功"),z.value=!1,await y(),await N.updateUserSpace(),_.value=!1,s.value=[]}catch(t){console.error("删除失败:",t),g.error("删除失败")}},$=t=>{s.value=Array.isArray(t)?t:[t],z.value=!0},Q=()=>{if(s.value.length===0){g.warning("请选择要恢复的文件");return}L(s.value)},W=()=>{if(s.value.length===0){g.warning("请选择要删除的文件");return}$(s.value)},M=t=>t.folderType===1?pe:t.fileCategory===1?ve:t.fileCategory===2?_e:t.fileCategory===3?me:t.fileCategory===4?ge:ye,X=t=>{if(!t)return"未知";const e=new Date(t),p=new Date(e.getTime()+5*24*60*60*1e3),m=Math.ceil((p-new Date)/(24*60*60*1e3));return m<=0?"即将删除":m===1?"最后1天":`${m}天`},Y=async t=>{try{const e=await he(t,1);e.code===1&&(T.value[t]=e.data)}catch(e){console.error("获取文件夹大小失败:",e)}};return ie(()=>F.value,t=>{t.forEach(e=>{e.folderType===1&&T.value[e.fileId]===void 0&&Y(e.fileId)})},{immediate:!0}),re(()=>{y()}),ce(()=>{w.value&&clearTimeout(w.value)}),(t,e)=>{const p=c("el-alert"),i=c("el-button"),m=c("el-button-group"),h=c("el-icon"),Z=c("el-input"),C=c("el-table-column"),ee=c("el-image"),te=c("el-table"),ae=c("el-pagination"),le=c("el-empty"),ne=c("el-dialog");return o(),v("div",ze,[r("div",we,[a(p,{title:"每天晚上12点都会清理存放超过5天的文件，请及时处理。",type:"warning",closable:!1,"show-icon":""})]),r("div",Se,[r("div",Fe,[_.value?(o(),v(x,{key:1},[a(m,null,{default:n(()=>[a(i,{type:"primary",size:"large",onClick:Q,disabled:!s.value.length},{default:n(()=>e[6]||(e[6]=[d(" 恢复 ")])),_:1},8,["disabled"]),a(i,{type:"danger",size:"large",onClick:W,disabled:!s.value.length},{default:n(()=>e[7]||(e[7]=[d(" 彻底删除 ")])),_:1},8,["disabled"])]),_:1}),a(i,{size:"large",onClick:H},{default:n(()=>e[8]||(e[8]=[d(" 取消操作 ")])),_:1})],64)):(o(),k(i,{key:0,size:"large",onClick:G},{default:n(()=>e[5]||(e[5]=[d("批量操作")])),_:1}))]),r("div",Ie,[a(Z,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=l=>V.value=l),placeholder:"输入文件名搜索",class:"search-input",size:"large",clearable:"",onInput:B,onClear:B},{prefix:n(()=>[a(h,null,{default:n(()=>[a(S(ue))]),_:1})]),_:1},8,["modelValue"])])]),r("div",Te,[r("div",Re,[F.value.length>0?(o(),v("div",Ve,[a(te,{data:F.value,style:{width:"100%"},onSelectionChange:J},{default:n(()=>[_.value?(o(),k(C,{key:0,type:"selection",width:"55"})):de("",!0),a(C,{label:"文件名","min-width":"400"},{default:n(({row:l})=>[r("div",xe,[l.fileCover?(o(),k(ee,{key:0,src:`${S(O)}/api/file/getFile/${l.fileCover}`,class:"file-cover","preview-src-list":[],fit:"cover"},{error:n(()=>[a(h,{size:20,class:"file-icon"},{default:n(()=>[(o(),k(P(M(l))))]),_:2},1024)]),_:2},1032,["src"])):(o(),k(h,{key:1,size:20,class:"file-icon"},{default:n(()=>[(o(),k(P(M(l))))]),_:2},1024)),r("span",De,R(l.fileName),1)])]),_:1}),a(C,{prop:"fileSize",label:"大小",width:"150"},{default:n(({row:l})=>[l.folderType===1?(o(),v(x,{key:0},[T.value[l.fileId]!==void 0?(o(),v("span",Ne,R(S(j)(T.value[l.fileId])),1)):(o(),v("span",Ue,[a(h,{class:"is-loading"},{default:n(()=>[a(S(fe))]),_:1})]))],64)):(o(),v(x,{key:1},[d(R(S(j)(l.fileSize)),1)],64))]),_:1}),a(C,{prop:"recoverTime",label:"删除时间",width:"180"}),a(C,{label:"剩余保存时间",width:"150"},{default:n(({row:l})=>[d(R(X(l.recoverTime)),1)]),_:1}),a(C,{label:"操作",width:"180",fixed:"right"},{default:n(({row:l})=>[a(m,null,{default:n(()=>[a(i,{type:"primary",link:"",onClick:E(oe=>L([l]),["stop"])},{default:n(()=>e[9]||(e[9]=[d(" 恢复 ")])),_:2},1032,["onClick"]),a(i,{type:"danger",link:"",onClick:E(oe=>$([l]),["stop"])},{default:n(()=>e[10]||(e[10]=[d(" 彻底删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"]),r("div",Be,[a(ae,{"current-page":b.value,"onUpdate:currentPage":e[1]||(e[1]=l=>b.value=l),"page-size":I.value,"onUpdate:pageSize":e[2]||(e[2]=l=>I.value=l),total:U.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",background:"",onSizeChange:A,onCurrentChange:q},null,8,["current-page","page-size","total"])])])):(o(),v("div",Le,[a(le,{description:"回收站为空"})]))])]),a(ne,{modelValue:z.value,"onUpdate:modelValue":e[4]||(e[4]=l=>z.value=l),title:"确认删除",width:"30%"},{footer:n(()=>[r("span",$e,[a(i,{onClick:e[3]||(e[3]=l=>z.value=!1)},{default:n(()=>e[11]||(e[11]=[d("取消")])),_:1}),a(i,{type:"danger",onClick:K},{default:n(()=>e[12]||(e[12]=[d("确定")])),_:1})])]),default:n(()=>[e[13]||(e[13]=r("span",null,"确定要彻底删除选中的文件吗？此操作不可恢复。",-1))]),_:1},8,["modelValue"])])}}},Oe=se(Me,[["__scopeId","data-v-83878537"]]);export{Oe as default};
