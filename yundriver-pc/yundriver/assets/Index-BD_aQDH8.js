import{F as xt,_ as Vt,r as v,a as he,G as ve,o as Ft,H as St,u as Nt,c as U,b as p,d as s,w as u,x as D,I as O,E as g,k as ke,e as w,f as y,g as c,l as C,J as At,K as ge,z as ie,L as Bt,M as Te,N as Ut,O as kt,P as Tt,Q as zt,t as L,R as Mt,S as Dt,q as ze,T as Me,U as De,v as $e,V as $t,W as Pt,n as Pe,X as Et,Y as Ee,Z as Lt,$ as Rt,a0 as Le}from"./index-xsXBKXXp.js";import{u as jt,g as Kt,c as Ot,r as Wt,a as qt,d as Jt,b as Gt,e as Ht,f as Zt}from"./file-DWF0CrJu.js";import{F as Qt}from"./FilePreview-znKgSkON.js";var ye={exports:{}},Re;function Xt(){return Re||(Re=1,function(ue,N){(function(V){ue.exports=V()})(function(V){var I=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function m(i,r){var t=i[0],e=i[1],n=i[2],a=i[3];t+=(e&n|~e&a)+r[0]-680876936|0,t=(t<<7|t>>>25)+e|0,a+=(t&e|~t&n)+r[1]-389564586|0,a=(a<<12|a>>>20)+t|0,n+=(a&t|~a&e)+r[2]+606105819|0,n=(n<<17|n>>>15)+a|0,e+=(n&a|~n&t)+r[3]-1044525330|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&a)+r[4]-176418897|0,t=(t<<7|t>>>25)+e|0,a+=(t&e|~t&n)+r[5]+1200080426|0,a=(a<<12|a>>>20)+t|0,n+=(a&t|~a&e)+r[6]-1473231341|0,n=(n<<17|n>>>15)+a|0,e+=(n&a|~n&t)+r[7]-45705983|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&a)+r[8]+1770035416|0,t=(t<<7|t>>>25)+e|0,a+=(t&e|~t&n)+r[9]-1958414417|0,a=(a<<12|a>>>20)+t|0,n+=(a&t|~a&e)+r[10]-42063|0,n=(n<<17|n>>>15)+a|0,e+=(n&a|~n&t)+r[11]-1990404162|0,e=(e<<22|e>>>10)+n|0,t+=(e&n|~e&a)+r[12]+1804603682|0,t=(t<<7|t>>>25)+e|0,a+=(t&e|~t&n)+r[13]-40341101|0,a=(a<<12|a>>>20)+t|0,n+=(a&t|~a&e)+r[14]-1502002290|0,n=(n<<17|n>>>15)+a|0,e+=(n&a|~n&t)+r[15]+1236535329|0,e=(e<<22|e>>>10)+n|0,t+=(e&a|n&~a)+r[1]-165796510|0,t=(t<<5|t>>>27)+e|0,a+=(t&n|e&~n)+r[6]-1069501632|0,a=(a<<9|a>>>23)+t|0,n+=(a&e|t&~e)+r[11]+643717713|0,n=(n<<14|n>>>18)+a|0,e+=(n&t|a&~t)+r[0]-373897302|0,e=(e<<20|e>>>12)+n|0,t+=(e&a|n&~a)+r[5]-701558691|0,t=(t<<5|t>>>27)+e|0,a+=(t&n|e&~n)+r[10]+38016083|0,a=(a<<9|a>>>23)+t|0,n+=(a&e|t&~e)+r[15]-660478335|0,n=(n<<14|n>>>18)+a|0,e+=(n&t|a&~t)+r[4]-405537848|0,e=(e<<20|e>>>12)+n|0,t+=(e&a|n&~a)+r[9]+568446438|0,t=(t<<5|t>>>27)+e|0,a+=(t&n|e&~n)+r[14]-1019803690|0,a=(a<<9|a>>>23)+t|0,n+=(a&e|t&~e)+r[3]-187363961|0,n=(n<<14|n>>>18)+a|0,e+=(n&t|a&~t)+r[8]+1163531501|0,e=(e<<20|e>>>12)+n|0,t+=(e&a|n&~a)+r[13]-1444681467|0,t=(t<<5|t>>>27)+e|0,a+=(t&n|e&~n)+r[2]-51403784|0,a=(a<<9|a>>>23)+t|0,n+=(a&e|t&~e)+r[7]+1735328473|0,n=(n<<14|n>>>18)+a|0,e+=(n&t|a&~t)+r[12]-1926607734|0,e=(e<<20|e>>>12)+n|0,t+=(e^n^a)+r[5]-378558|0,t=(t<<4|t>>>28)+e|0,a+=(t^e^n)+r[8]-2022574463|0,a=(a<<11|a>>>21)+t|0,n+=(a^t^e)+r[11]+1839030562|0,n=(n<<16|n>>>16)+a|0,e+=(n^a^t)+r[14]-35309556|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^a)+r[1]-1530992060|0,t=(t<<4|t>>>28)+e|0,a+=(t^e^n)+r[4]+1272893353|0,a=(a<<11|a>>>21)+t|0,n+=(a^t^e)+r[7]-155497632|0,n=(n<<16|n>>>16)+a|0,e+=(n^a^t)+r[10]-1094730640|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^a)+r[13]+681279174|0,t=(t<<4|t>>>28)+e|0,a+=(t^e^n)+r[0]-358537222|0,a=(a<<11|a>>>21)+t|0,n+=(a^t^e)+r[3]-722521979|0,n=(n<<16|n>>>16)+a|0,e+=(n^a^t)+r[6]+76029189|0,e=(e<<23|e>>>9)+n|0,t+=(e^n^a)+r[9]-640364487|0,t=(t<<4|t>>>28)+e|0,a+=(t^e^n)+r[12]-421815835|0,a=(a<<11|a>>>21)+t|0,n+=(a^t^e)+r[15]+530742520|0,n=(n<<16|n>>>16)+a|0,e+=(n^a^t)+r[2]-995338651|0,e=(e<<23|e>>>9)+n|0,t+=(n^(e|~a))+r[0]-198630844|0,t=(t<<6|t>>>26)+e|0,a+=(e^(t|~n))+r[7]+1126891415|0,a=(a<<10|a>>>22)+t|0,n+=(t^(a|~e))+r[14]-1416354905|0,n=(n<<15|n>>>17)+a|0,e+=(a^(n|~t))+r[5]-57434055|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~a))+r[12]+1700485571|0,t=(t<<6|t>>>26)+e|0,a+=(e^(t|~n))+r[3]-1894986606|0,a=(a<<10|a>>>22)+t|0,n+=(t^(a|~e))+r[10]-1051523|0,n=(n<<15|n>>>17)+a|0,e+=(a^(n|~t))+r[1]-2054922799|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~a))+r[8]+1873313359|0,t=(t<<6|t>>>26)+e|0,a+=(e^(t|~n))+r[15]-30611744|0,a=(a<<10|a>>>22)+t|0,n+=(t^(a|~e))+r[6]-1560198380|0,n=(n<<15|n>>>17)+a|0,e+=(a^(n|~t))+r[13]+1309151649|0,e=(e<<21|e>>>11)+n|0,t+=(n^(e|~a))+r[4]-145523070|0,t=(t<<6|t>>>26)+e|0,a+=(e^(t|~n))+r[11]-1120210379|0,a=(a<<10|a>>>22)+t|0,n+=(t^(a|~e))+r[2]+718787259|0,n=(n<<15|n>>>17)+a|0,e+=(a^(n|~t))+r[9]-343485551|0,e=(e<<21|e>>>11)+n|0,i[0]=t+i[0]|0,i[1]=e+i[1]|0,i[2]=n+i[2]|0,i[3]=a+i[3]|0}function T(i){var r=[],t;for(t=0;t<64;t+=4)r[t>>2]=i.charCodeAt(t)+(i.charCodeAt(t+1)<<8)+(i.charCodeAt(t+2)<<16)+(i.charCodeAt(t+3)<<24);return r}function x(i){var r=[],t;for(t=0;t<64;t+=4)r[t>>2]=i[t]+(i[t+1]<<8)+(i[t+2]<<16)+(i[t+3]<<24);return r}function A(i){var r=i.length,t=[1732584193,-271733879,-1732584194,271733878],e,n,a,S,z,P;for(e=64;e<=r;e+=64)m(t,T(i.substring(e-64,e)));for(i=i.substring(e-64),n=i.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)a[e>>2]|=i.charCodeAt(e)<<(e%4<<3);if(a[e>>2]|=128<<(e%4<<3),e>55)for(m(t,a),e=0;e<16;e+=1)a[e]=0;return S=r*8,S=S.toString(16).match(/(.*?)(.{0,8})$/),z=parseInt(S[2],16),P=parseInt(S[1],16)||0,a[14]=z,a[15]=P,m(t,a),t}function j(i){var r=i.length,t=[1732584193,-271733879,-1732584194,271733878],e,n,a,S,z,P;for(e=64;e<=r;e+=64)m(t,x(i.subarray(e-64,e)));for(i=e-64<r?i.subarray(e-64):new Uint8Array(0),n=i.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<n;e+=1)a[e>>2]|=i[e]<<(e%4<<3);if(a[e>>2]|=128<<(e%4<<3),e>55)for(m(t,a),e=0;e<16;e+=1)a[e]=0;return S=r*8,S=S.toString(16).match(/(.*?)(.{0,8})$/),z=parseInt(S[2],16),P=parseInt(S[1],16)||0,a[14]=z,a[15]=P,m(t,a),t}function $(i){var r="",t;for(t=0;t<4;t+=1)r+=I[i>>t*8+4&15]+I[i>>t*8&15];return r}function B(i){var r;for(r=0;r<i.length;r+=1)i[r]=$(i[r]);return i.join("")}B(A("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function i(r,t){return r=r|0||0,r<0?Math.max(r+t,0):Math.min(r,t)}ArrayBuffer.prototype.slice=function(r,t){var e=this.byteLength,n=i(r,e),a=e,S,z,P,k;return t!==V&&(a=i(t,e)),n>a?new ArrayBuffer(0):(S=a-n,z=new ArrayBuffer(S),P=new Uint8Array(z),k=new Uint8Array(this,n,S),P.set(k),z)}}();function W(i){return/[\u0080-\uFFFF]/.test(i)&&(i=unescape(encodeURIComponent(i))),i}function de(i,r){var t=i.length,e=new ArrayBuffer(t),n=new Uint8Array(e),a;for(a=0;a<t;a+=1)n[a]=i.charCodeAt(a);return r?n:e}function fe(i){return String.fromCharCode.apply(null,new Uint8Array(i))}function Q(i,r,t){var e=new Uint8Array(i.byteLength+r.byteLength);return e.set(new Uint8Array(i)),e.set(new Uint8Array(r),i.byteLength),e}function q(i){var r=[],t=i.length,e;for(e=0;e<t-1;e+=2)r.push(parseInt(i.substr(e,2),16));return String.fromCharCode.apply(String,r)}function h(){this.reset()}return h.prototype.append=function(i){return this.appendBinary(W(i)),this},h.prototype.appendBinary=function(i){this._buff+=i,this._length+=i.length;var r=this._buff.length,t;for(t=64;t<=r;t+=64)m(this._hash,T(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},h.prototype.end=function(i){var r=this._buff,t=r.length,e,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a;for(e=0;e<t;e+=1)n[e>>2]|=r.charCodeAt(e)<<(e%4<<3);return this._finish(n,t),a=B(this._hash),i&&(a=q(a)),this.reset(),a},h.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},h.prototype.setState=function(i){return this._buff=i.buff,this._length=i.length,this._hash=i.hash,this},h.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},h.prototype._finish=function(i,r){var t=r,e,n,a;if(i[t>>2]|=128<<(t%4<<3),t>55)for(m(this._hash,i),t=0;t<16;t+=1)i[t]=0;e=this._length*8,e=e.toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(e[2],16),a=parseInt(e[1],16)||0,i[14]=n,i[15]=a,m(this._hash,i)},h.hash=function(i,r){return h.hashBinary(W(i),r)},h.hashBinary=function(i,r){var t=A(i),e=B(t);return r?q(e):e},h.ArrayBuffer=function(){this.reset()},h.ArrayBuffer.prototype.append=function(i){var r=Q(this._buff.buffer,i),t=r.length,e;for(this._length+=i.byteLength,e=64;e<=t;e+=64)m(this._hash,x(r.subarray(e-64,e)));return this._buff=e-64<t?new Uint8Array(r.buffer.slice(e-64)):new Uint8Array(0),this},h.ArrayBuffer.prototype.end=function(i){var r=this._buff,t=r.length,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n,a;for(n=0;n<t;n+=1)e[n>>2]|=r[n]<<(n%4<<3);return this._finish(e,t),a=B(this._hash),i&&(a=q(a)),this.reset(),a},h.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.ArrayBuffer.prototype.getState=function(){var i=h.prototype.getState.call(this);return i.buff=fe(i.buff),i},h.ArrayBuffer.prototype.setState=function(i){return i.buff=de(i.buff,!0),h.prototype.setState.call(this,i)},h.ArrayBuffer.prototype.destroy=h.prototype.destroy,h.ArrayBuffer.prototype._finish=h.prototype._finish,h.ArrayBuffer.hash=function(i,r){var t=j(new Uint8Array(i)),e=B(t);return r?q(e):e},h})}(ye)),ye.exports}var Yt=Xt();const el=xt(Yt),ae=5*1024*1024;class tl{constructor(N,V){this.file=N,this.filePid=V,this.chunks=Math.ceil(N.size/ae),this.currentChunk=0,this.fileId="",this.status=""}async calculateMD5(){return new Promise((N,V)=>{const I=new el.ArrayBuffer,m=new FileReader;let T=0;const x=()=>{const A=T*ae,j=Math.min(A+ae,this.file.size);m.readAsArrayBuffer(this.file.slice(A,j))};m.onload=A=>{I.append(A.target.result),T++,T<this.chunks?x():N(I.end())},m.onerror=()=>{V(new Error("MD5计算失败"))},x()})}async uploadChunk(N){const V=this.currentChunk*ae,I=Math.min(V+ae,this.file.size),m=this.file.slice(V,I);new FormData().append("file",m);const x=await jt({fileId:this.fileId,filePid:this.filePid,fileName:this.file.name,fileMd5:N,chunkIndex:this.currentChunk,chunks:this.chunks,file:m});if(x.code===1)return this.fileId=x.data.fileId,this.status=x.data.status,this.currentChunk++,x.data;throw new Error(x.msg||"上传失败")}async upload(N){try{const V=await this.calculateMD5();for(;this.currentChunk<this.chunks;){const I=await this.uploadChunk(V),m=Math.round(this.currentChunk/this.chunks*100);if(N&&N(m),I.status==="upload_second"||I.status==="upload_finish")return{status:"success",fileId:this.fileId}}return{status:"success",fileId:this.fileId}}catch(V){throw new Error("文件上传失败："+V.message)}}}const ll={class:"page-container"},al={class:"action-bar"},nl={class:"left"},ol={class:"search"},rl={class:"breadcrumb"},sl={class:"content-area"},il={class:"table-container"},ul={key:0,class:"file-list"},dl=["onClick"],fl={class:"file-name"},cl={key:0},pl={key:1},ml={class:"pagination"},hl={key:1,class:"empty-state"},vl={class:"empty-actions"},gl={class:"upload-dialog-content"},yl={class:"upload-actions"},_l={key:0,class:"upload-list"},bl={class:"file-info"},wl={class:"file-details"},Cl={class:"file-name-row"},Il=["title"],xl={class:"file-size"},Vl={class:"progress-row"},Fl={class:"dialog-footer"},Sl={class:"dialog-footer"},Nl={class:"dialog-footer"},Al={class:"dialog-footer"},Bl={class:"folder-tree"},Ul={class:"dialog-footer"},kl={class:"code-input-group"},Tl={class:"dialog-footer"},zl={__name:"Index",setup(ue){Lt(o=>({"2c233e57":m.value?"none":"auto",ec4d6b34:m.value?"var(--el-text-color-disabled)":"var(--el-text-color-regular)"}));const N=v(""),V=v(!1),I=v([]),m=v(!1),T=v([]),x=v(1),A=v(10),j=v(0),$=v("0"),B=v([]),W=v(!1),de=v(null),fe=v(!1),Q=he({folderName:""}),q={folderName:[{required:!0,message:"请输入文件夹名称",trigger:"blur"},{min:1,max:100,message:"长度在 1 到 100 个字符",trigger:"blur"}]},h=v(!1),i=v(null),r=v(!1),t=he({fileId:"",fileName:"",extension:""}),e={fileName:[{required:!0,message:"请输入名称",trigger:"blur"},{min:1,max:100,message:"长度在 1 到 100 个字符",trigger:"blur"}]},n=v({}),a=async o=>{try{const l=await Ht(o,2);l.code===1&&(n.value[o]=l.data)}catch(l){console.error("获取文件夹大小失败:",l)}},S=o=>{I.value.some(f=>f.name===o.name)||I.value.push({raw:o.raw,name:o.name,size:o.size,progress:0,status:"waiting"})},z=o=>{if(o===0)return"0 B";const l=1024,f=["B","KB","MB","GB","TB"],M=Math.floor(Math.log(o)/Math.log(l));return(o/Math.pow(l,M)).toFixed(2)+" "+f[M]},P=async()=>{if(I.value.length===0)return;m.value=!0;let o=0,l=I.value.length;try{for(const f of I.value){if(f.status==="success"){o++;continue}f.status="uploading";const M=new tl(f.raw,$.value);try{(await M.upload(R=>{f.progress=R})).status==="success"&&(f.status="success",f.progress=100,o++,await k())}catch(b){f.status="error",g.error(`文件 ${f.name} 上传失败：${b.message}`)}}o>0&&(o===l?g.success("所有文件上传成功"):g.warning(`${o}/${l} 个文件上传成功`),setTimeout(()=>{V.value=!1,I.value=[]},1e3))}finally{m.value=!1}},k=async()=>{try{const o=await Kt({fileName:N.value,page:x.value,pageSize:A.value,filePid:$.value});o.code===1&&(T.value=o.data.rows||[],j.value=o.data.total||0)}catch(o){console.error("获取文件列表失败:",o),g.error("获取文件列表失败")}},je=()=>{x.value=1,k()},Ke=o=>{A.value=o,k()},Oe=o=>{x.value=o,k()};ve(N,()=>{je()});const We=()=>{const o={currentFolderId:$.value,folderPath:B.value};localStorage.setItem("filePathState",JSON.stringify(o))},qe=()=>{const o=localStorage.getItem("filePathState");if(o)try{const l=JSON.parse(o);$.value=l.currentFolderId,B.value=l.folderPath}catch(l){console.error("恢复路径状态失败:",l)}},_e=async(o,l)=>{if(console.log("导航到文件夹:",o,"路径索引:",l,"当前路径:",B.value),$.value=o,x.value=1,o==="0")B.value=[];else if(typeof l=="number")B.value=B.value.slice(0,l+1);else{const f=T.value.find(M=>M.fileId===o);f&&B.value.push(f)}await k(),We()};Ft(async()=>{qe(),await k()}),St(()=>{localStorage.removeItem("filePathState")});const be=async()=>{try{const{value:o}=await ke.prompt("请输入文件夹名称","新建文件夹",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^[^\\/:\*\?"<>\|]+$/,inputErrorMessage:"文件夹名称不能包含特殊字符",beforeClose:(l,f,M)=>{if(l==="confirm"&&!f.inputValue){g.warning("请输入文件夹名称");return}M()}});if(o){const l={fileName:o,filePid:$.value};console.log("创建文件夹参数:",l);const f=await Ot(l);f.code===1?(g.success("创建成功"),await k()):g.error(f.message||"创建失败")}}catch(o){o!=="cancel"&&(console.error("创建文件夹失败:",o),g.error("创建文件夹失败"))}},Je=o=>{const l=[".jpg",".jpeg",".png",".gif",".bmp",".webp"],f=o.toLowerCase().substring(o.lastIndexOf("."));return l.includes(f)},Ge=o=>{const l=[".pdf",".doc",".docx",".xls",".xlsx",".ppt",".pptx",".txt"],f=o.toLowerCase().substring(o.lastIndexOf("."));return l.includes(f)},He=o=>{if(t.fileId=o.fileId,o.folderType===1)t.fileName=o.fileName;else{const l=o.fileName.lastIndexOf(".");l>-1?t.fileName=o.fileName.substring(0,l):t.fileName=o.fileName}h.value=!0},we=async()=>{i.value&&await i.value.validate(async o=>{if(o)try{r.value=!0,(await Wt({fileId:t.fileId,fileName:t.fileName})).code===1&&(g.success("重命名成功"),h.value=!1,await k())}finally{r.value=!1}})},ce=v(!1),Ce=v(null);v(null);const Ze=o=>{if(o.fileCategory===1)return 1;if(o.fileCategory===2)return 2;if(o.fileCategory===3)return 3;const l=o.fileName.toLowerCase();return l.endsWith(".pdf")?4:l.endsWith(".doc")||l.endsWith(".docx")?5:l.endsWith(".xls")||l.endsWith(".xlsx")?6:l.endsWith(".txt")||l.endsWith(".md")?7:Qe(l)?8:0},Qe=o=>[".js",".ts",".java",".py",".cpp",".c",".h",".html",".css",".scss",".less",".json",".xml"].some(f=>o.toLowerCase().endsWith(f)),Ie=o=>{if(o.folderType===1)B.value.push({fileId:o.fileId,fileName:o.fileName}),$.value=o.fileId,x.value=1,k();else{const l=Ze(o);if(l===0){g.info("该文件类型暂不支持预览");return}Ce.value={...o,fileType:l,isVideo:l===1,previewUrl:`/api/file/getFile?fileId=${o.fileId}`,videoInfoUrl:l===1?`/api/file/ts/getVideoInfo?fileId=${o.fileId}`:void 0},ce.value=!0}},J=v(!1),_=v([]),X=v(!1),G=v(!1);v([]);const K=v(""),ne=v(null),Xe=()=>{J.value=!0},Ye=()=>{J.value=!1,_.value=[]},xe=o=>{const l=Array.isArray(o)?o:[o];_.value=l,X.value=!0},Ve=async o=>{_.value=o,G.value=!0,K.value=""},et=o=>{if(_.value.some(l=>l.fileId===o.fileId)){g.warning("不能移动到被选中的文件夹");return}if(o.fileId===$.value){g.warning("不能移动到当前文件夹");return}K.value=o.fileId},tt=()=>{if(_.value.length===0){g.warning("请选择要删除的文件");return}xe(_.value)},lt=()=>{if(_.value.length===0){g.warning("请选择要移动的文件");return}Ve(_.value)},at=async()=>{if(!K.value){g.warning("请选择目标文件夹");return}try{await qt({fileIds:_.value.map(o=>o.fileId).join(","),filePid:K.value}),g.success("移动成功"),G.value=!1,K.value="",J.value=!1,_.value=[],await k()}catch(o){console.error("移动失败:",o),g.error("移动失败")}},nt=async()=>{try{const o=_.value.map(l=>l.fileId).join(",");await Jt(o),g.success("删除成功"),X.value=!1,await k(),J.value=!1,_.value=[]}catch(o){console.error("删除失败:",o),g.error("删除失败")}},ot=o=>{_.value=o},rt=async(o,l)=>{if(o.level===0){l([{fileId:"0",fileName:"全部文件",children:[]}]);return}try{const f=await Gt(o.data.fileId);if(f.code===1&&f.data){const M=f.data.filter(b=>{const R=_.value.some(H=>H.fileId===b.fileId),re=_.value.some(H=>H.folderType===1&&b.filePid===H.fileId);return!R&&!re});l(M)}else l([])}catch(f){console.error("加载文件夹失败:",f),l([])}};ve(G,async o=>{o&&ne.value&&(ne.value.store.setData([{fileId:"0",fileName:"全部文件",children:[]}]),ne.value.setCurrentKey(null),K.value="")});const Fe=async o=>{if(!oe.value)try{oe.value=!0,await Zt(o.fileId),g.success("下载成功")}catch(l){console.error("下载失败:",l),g.error("下载失败")}finally{oe.value=!1}},st=()=>{if(_.value.length===0){g.warning("请选择要下载的文件");return}oe.value||Fe(_.value[0])},Y=v(!1),F=he({fileId:"",validType:1,codeType:0,code:""}),pe=v(!1),Se=o=>{const l=Array.isArray(o)?o:[o];F.fileId=l.map(f=>f.fileId).join(","),F.validType=1,F.codeType=0,F.code="",Y.value=!0},it=async()=>{if(F.codeType===1){if(!F.code){g.warning("请输入提取码");return}if(!/^\w{5}$/.test(F.code)){g.warning("提取码必须是5位字母或数字");return}}try{pe.value=!0;const o=await Rt({fileId:F.fileId,validType:F.validType,code:F.codeType===1?F.code:void 0});if(o.code===1){g.success("分享创建成功");const l=`分享链接：${window.location.origin}/share/${o.data.shareId}
提取码：${o.data.code}`;ke.alert(l,"分享信息",{confirmButtonText:"复制信息",callback:()=>{navigator.clipboard.writeText(l),g.success("分享信息已复制到剪贴板")}}),Y.value=!1}}catch(o){console.error("创建分享失败:",o),g.error("创建分享失败")}finally{pe.value=!1}},ut=()=>{if(_.value.length===0){g.warning("请选择要分享的文件");return}Se(_.value)};ve(()=>T.value,o=>{o.forEach(l=>{l.folderType===1&&n.value[l.fileId]===void 0&&a(l.fileId)})},{immediate:!0});const dt=o=>o.status==="error"?"上传失败":o.progress===100?"上传完成":`${o.progress}%`,ft=o=>{o.status="waiting",o.progress=0},ct=()=>{if(m.value){g.warning("文件正在上传中，请等待上传完成");return}V.value=!1,I.value=[]},Ne=()=>{V.value=!0,I.value=[]},pt=o=>{g.info("该文件类型暂不支持预览")},mt=(o,l)=>{switch(o){case"open":Ie(l);break;case"share":Se(l);break;case"download":Fe(l);break;case"move":Ve([l]);break;case"rename":He(l);break;case"delete":xe([l]);break}};Nt();const oe=v(!1);return(o,l)=>{const f=w("el-button"),M=w("el-button-group"),b=w("el-icon"),R=w("el-input"),re=w("el-breadcrumb-item"),H=w("el-breadcrumb"),ee=w("el-table-column"),E=w("el-dropdown-item"),ht=w("el-dropdown-menu"),vt=w("el-dropdown"),gt=w("el-table"),te=w("el-option"),Ae=w("el-select"),Be=w("el-space"),yt=w("el-pagination"),_t=w("el-empty"),bt=w("el-upload"),wt=w("el-progress"),Z=w("el-dialog"),se=w("el-form-item"),me=w("el-form"),Ct=w("el-tree"),Ue=w("el-radio"),It=w("el-radio-group");return y(),U("div",ll,[p("div",al,[p("div",nl,[s(f,{type:"primary",size:"large",onClick:Ne},{default:u(()=>l[23]||(l[23]=[c("上传")])),_:1}),s(f,{size:"large",onClick:be},{default:u(()=>l[24]||(l[24]=[c("新建文件夹")])),_:1}),J.value?(y(),U(O,{key:1},[s(M,null,{default:u(()=>[s(f,{type:"danger",size:"large",onClick:tt,disabled:!_.value.length},{default:u(()=>l[26]||(l[26]=[c(" 删除 ")])),_:1},8,["disabled"]),s(f,{type:"primary",size:"large",onClick:lt,disabled:!_.value.length},{default:u(()=>l[27]||(l[27]=[c(" 移动到 ")])),_:1},8,["disabled"]),s(f,{type:"primary",size:"large",onClick:st,disabled:!_.value.length},{default:u(()=>l[28]||(l[28]=[c(" 下载 ")])),_:1},8,["disabled"]),s(f,{type:"primary",size:"large",onClick:ut,disabled:!_.value.length},{default:u(()=>l[29]||(l[29]=[c(" 分享 ")])),_:1},8,["disabled"])]),_:1}),s(f,{size:"large",onClick:Ye},{default:u(()=>l[30]||(l[30]=[c(" 取消操作 ")])),_:1})],64)):(y(),D(f,{key:0,size:"large",onClick:Xe},{default:u(()=>l[25]||(l[25]=[c("批量操作")])),_:1}))]),p("div",ol,[s(R,{modelValue:N.value,"onUpdate:modelValue":l[0]||(l[0]=d=>N.value=d),placeholder:"输入文件名搜索",class:"search-input",size:"large"},{prefix:u(()=>[s(b,null,{default:u(()=>[s(C(At))]),_:1})]),_:1},8,["modelValue"])])]),p("div",rl,[s(H,{separator:"/"},{default:u(()=>[s(re,{onClick:l[1]||(l[1]=d=>_e("0"))},{default:u(()=>l[31]||(l[31]=[c("全部文件")])),_:1}),(y(!0),U(O,null,ge(B.value,(d,le)=>(y(),D(re,{key:d.fileId,onClick:Ml=>_e(d.fileId,le)},{default:u(()=>[c(L(d.fileName),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),p("div",sl,[p("div",il,[T.value.length>0?(y(),U("div",ul,[s(gt,{data:T.value,style:{width:"100%"},"row-key":"fileId","tree-props":{children:"children",hasChildren:"hasChildren"},onSelectionChange:ot},{default:u(()=>[J.value?(y(),D(ee,{key:0,type:"selection",width:"55"})):ie("",!0),s(ee,{label:"文件名","min-width":"400"},{default:u(({row:d})=>[p("div",{class:"file-name-cell",onClick:le=>Ie(d)},[s(b,{size:20,class:"file-icon"},{default:u(()=>[d.folderType===1?(y(),D(C(Bt),{key:0})):Ge(d.fileName)?(y(),D(C(Te),{key:1})):d.fileCategory===1?(y(),D(C(Ut),{key:2})):d.fileCategory===2?(y(),D(C(kt),{key:3})):Je(d.fileName)?(y(),D(C(Tt),{key:4})):(y(),D(C(zt),{key:5}))]),_:2},1024),p("span",fl,L(d.fileName),1)],8,dl)]),_:1}),s(ee,{prop:"fileSize",label:"大小",width:"150"},{default:u(({row:d})=>[d.folderType===1?(y(),U(O,{key:0},[n.value[d.fileId]!==void 0?(y(),U("span",cl,L(z(n.value[d.fileId])),1)):(y(),U("span",pl,[s(b,{class:"is-loading"},{default:u(()=>[s(C(Mt))]),_:1})]))],64)):(y(),U(O,{key:1},[c(L(z(d.fileSize)),1)],64))]),_:1}),s(ee,{prop:"lastUpdateTime",label:"修改时间",width:"200"}),s(ee,{label:"操作",width:"280"},{default:u(({row:d})=>[s(vt,{trigger:"click",onCommand:le=>mt(le,d)},{dropdown:u(()=>[s(ht,null,{default:u(()=>[d.folderType===1?(y(),U(O,{key:0},[s(E,{command:"open"},{default:u(()=>[s(b,null,{default:u(()=>[s(C(Dt))]),_:1}),l[33]||(l[33]=c("打开 "))]),_:1}),s(E,{command:"share"},{default:u(()=>[s(b,null,{default:u(()=>[s(C(ze))]),_:1}),l[34]||(l[34]=c("分享 "))]),_:1}),s(E,{command:"download"},{default:u(()=>[s(b,null,{default:u(()=>[s(C(Me))]),_:1}),l[35]||(l[35]=c("下载 "))]),_:1}),s(E,{divided:"",command:"move"},{default:u(()=>[s(b,null,{default:u(()=>[s(C(De))]),_:1}),l[36]||(l[36]=c("移动到 "))]),_:1}),s(E,{command:"delete"},{default:u(()=>[s(b,null,{default:u(()=>[s(C($e))]),_:1}),l[37]||(l[37]=c("删除 "))]),_:1})],64)):(y(),U(O,{key:1},[s(E,{command:"download"},{default:u(()=>[s(b,null,{default:u(()=>[s(C(Me))]),_:1}),l[38]||(l[38]=c("下载 "))]),_:1}),s(E,{command:"share"},{default:u(()=>[s(b,null,{default:u(()=>[s(C(ze))]),_:1}),l[39]||(l[39]=c("分享 "))]),_:1}),s(E,{command:"move"},{default:u(()=>[s(b,null,{default:u(()=>[s(C(De))]),_:1}),l[40]||(l[40]=c("移动 "))]),_:1}),s(E,{command:"rename"},{default:u(()=>[s(b,null,{default:u(()=>[s(C($t))]),_:1}),l[41]||(l[41]=c("重命名 "))]),_:1}),s(E,{command:"delete"},{default:u(()=>[s(b,null,{default:u(()=>[s(C($e))]),_:1}),l[42]||(l[42]=c("删除 "))]),_:1})],64))]),_:2},1024)]),default:u(()=>[s(f,{type:"primary",link:""},{default:u(()=>[l[32]||(l[32]=c(" 操作")),s(b,{class:"el-icon--right"},{default:u(()=>[s(C(Pt))]),_:1})]),_:1})]),_:2},1032,["onCommand"])]),_:1})]),_:1},8,["data"]),p("div",ml,[s(yt,{"current-page":x.value,"onUpdate:currentPage":l[4]||(l[4]=d=>x.value=d),"page-size":A.value,"onUpdate:pageSize":l[5]||(l[5]=d=>A.value=d),total:j.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",small:!1,background:"","pager-count":7,"prev-text":"上一页","next-text":"下一页",onSizeChange:Ke,onCurrentChange:Oe},{total:u(()=>[p("span",null,"共 "+L(j.value)+" 条",1)]),sizes:u(()=>[s(Be,null,{default:u(()=>[l[43]||(l[43]=p("span",null,"每页",-1)),s(Ae,{modelValue:A.value,"onUpdate:modelValue":l[2]||(l[2]=d=>A.value=d),style:{width:"100px"}},{default:u(()=>[(y(),U(O,null,ge([10,20,50,100],d=>s(te,{key:d,value:d,label:`${d}条`},null,8,["value","label"])),64))]),_:1},8,["modelValue"]),l[44]||(l[44]=p("span",null,"条",-1))]),_:1})]),jumper:u(()=>[s(Be,null,{default:u(()=>[l[45]||(l[45]=p("span",null,"前往",-1)),s(R,{modelValue:x.value,"onUpdate:modelValue":l[3]||(l[3]=d=>x.value=d),class:"jump-input",type:"number",min:1,max:Math.ceil(j.value/A.value)},null,8,["modelValue","max"]),l[46]||(l[46]=p("span",null,"页",-1))]),_:1})]),_:1},8,["current-page","page-size","total"])])])):(y(),U("div",hl,[s(_t,null,{description:u(()=>l[47]||(l[47]=[p("p",null,"当前目录为空",-1)])),default:u(()=>[p("div",vl,[s(f,{type:"primary",onClick:Ne},{default:u(()=>[s(b,null,{default:u(()=>[s(C(Pe))]),_:1}),l[48]||(l[48]=c("上传文件 "))]),_:1}),s(f,{onClick:be},{default:u(()=>[s(b,null,{default:u(()=>[s(C(Et))]),_:1}),l[49]||(l[49]=c("新建文件夹 "))]),_:1})])]),_:1})]))])]),s(Z,{modelValue:V.value,"onUpdate:modelValue":l[6]||(l[6]=d=>V.value=d),title:"上传文件",width:"520px","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:u(()=>[p("span",Fl,[s(f,{onClick:ct,disabled:m.value},{default:u(()=>[c(L(m.value?"正在上传":"关闭"),1)]),_:1},8,["disabled"])])]),default:u(()=>[p("div",gl,[p("div",yl,[s(bt,{class:"file-uploader","auto-upload":!1,"show-file-list":!1,"on-change":S,disabled:m.value,multiple:""},{trigger:u(()=>[s(f,{type:"primary",disabled:m.value,size:"large"},{default:u(()=>[s(b,null,{default:u(()=>[s(C(Pe))]),_:1}),l[50]||(l[50]=c(" 选择文件 "))]),_:1},8,["disabled"])]),_:1},8,["disabled"]),s(f,{type:"primary",onClick:P,loading:m.value,disabled:I.value.length===0,size:"large"},{default:u(()=>[c(L(m.value?"正在上传":"开始上传"),1)]),_:1},8,["loading","disabled"])]),I.value.length>0?(y(),U("div",_l,[(y(!0),U(O,null,ge(I.value,d=>(y(),U("div",{key:d.name,class:Le(["upload-item",{"upload-item-error":d.status==="error"}])},[p("div",bl,[s(b,{class:"file-icon"},{default:u(()=>[s(C(Te))]),_:1}),p("div",wl,[p("div",Cl,[p("span",{class:"file-name",title:d.name},L(d.name),9,Il),p("span",xl,L(z(d.size)),1)]),p("div",Vl,[s(wt,{percentage:d.progress,status:d.status==="error"?"exception":d.progress===100?"success":"","show-text":!1,"stroke-width":4},null,8,["percentage","status"]),p("span",{class:Le(["progress-text",{"text-error":d.status==="error"}])},L(dt(d)),3)])]),d.status==="error"?(y(),D(f,{key:0,type:"primary",link:"",onClick:le=>ft(d),disabled:m.value},{default:u(()=>l[51]||(l[51]=[c(" 重试 ")])),_:2},1032,["onClick","disabled"])):ie("",!0)])],2))),128))])):ie("",!0)])]),_:1},8,["modelValue"]),s(Z,{modelValue:W.value,"onUpdate:modelValue":l[9]||(l[9]=d=>W.value=d),title:"新建文件夹",width:"400px"},{footer:u(()=>[p("span",Sl,[s(f,{onClick:l[8]||(l[8]=d=>W.value=!1)},{default:u(()=>l[52]||(l[52]=[c("取消")])),_:1}),s(f,{type:"primary",onClick:o.submitNewFolder,loading:fe.value},{default:u(()=>l[53]||(l[53]=[c(" 确定 ")])),_:1},8,["onClick","loading"])])]),default:u(()=>[s(me,{ref_key:"folderFormRef",ref:de,model:Q,rules:q,"label-width":"80px"},{default:u(()=>[s(se,{label:"文件夹名",prop:"folderName"},{default:u(()=>[s(R,{modelValue:Q.folderName,"onUpdate:modelValue":l[7]||(l[7]=d=>Q.folderName=d),placeholder:"请输入文件夹名称",onKeyup:Ee(o.submitNewFolder,["enter"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),s(Z,{modelValue:h.value,"onUpdate:modelValue":l[12]||(l[12]=d=>h.value=d),title:"重命名",width:"400px"},{footer:u(()=>[p("span",Nl,[s(f,{onClick:l[11]||(l[11]=d=>h.value=!1)},{default:u(()=>l[54]||(l[54]=[c("取消")])),_:1}),s(f,{type:"primary",onClick:we,loading:r.value},{default:u(()=>l[55]||(l[55]=[c(" 确定 ")])),_:1},8,["loading"])])]),default:u(()=>[s(me,{ref_key:"renameFormRef",ref:i,model:t,rules:e,"label-width":"80px"},{default:u(()=>[s(se,{label:"名称",prop:"fileName"},{default:u(()=>[s(R,{modelValue:t.fileName,"onUpdate:modelValue":l[10]||(l[10]=d=>t.fileName=d),placeholder:"请输入新名称",onKeyup:Ee(we,["enter"])},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),s(Qt,{modelValue:ce.value,"onUpdate:modelValue":l[13]||(l[13]=d=>ce.value=d),file:Ce.value,onPreviewError:pt},null,8,["modelValue","file"]),s(Z,{modelValue:X.value,"onUpdate:modelValue":l[15]||(l[15]=d=>X.value=d),title:"确认删除",width:"30%"},{footer:u(()=>[p("span",Al,[s(f,{onClick:l[14]||(l[14]=d=>X.value=!1)},{default:u(()=>l[56]||(l[56]=[c("取消")])),_:1}),s(f,{type:"danger",onClick:nt},{default:u(()=>l[57]||(l[57]=[c("确定")])),_:1})])]),default:u(()=>[l[58]||(l[58]=p("span",null,"确定要删除选中的文件吗？此操作将文件移至回收站。",-1))]),_:1},8,["modelValue"]),s(Z,{modelValue:G.value,"onUpdate:modelValue":l[17]||(l[17]=d=>G.value=d),title:"移动到",width:"500px"},{footer:u(()=>[p("span",Ul,[s(f,{onClick:l[16]||(l[16]=d=>G.value=!1)},{default:u(()=>l[59]||(l[59]=[c("取消")])),_:1}),s(f,{type:"primary",onClick:at,disabled:!K.value||_.value.some(d=>d.fileId===K.value)},{default:u(()=>l[60]||(l[60]=[c(" 确定 ")])),_:1},8,["disabled"])])]),default:u(()=>[p("div",Bl,[s(Ct,{ref_key:"folderTreeRef",ref:ne,data:[{fileId:"0",fileName:"全部文件",children:[]}],"node-key":"fileId",props:{label:"fileName",children:"children",isLeaf:"isLeaf"},load:rt,lazy:"","highlight-current":"","default-expanded-keys":["0"],onNodeClick:et},null,512)])]),_:1},8,["modelValue"]),s(Z,{modelValue:Y.value,"onUpdate:modelValue":l[22]||(l[22]=d=>Y.value=d),title:"创建分享",width:"400px"},{footer:u(()=>[p("span",Tl,[s(f,{onClick:l[21]||(l[21]=d=>Y.value=!1)},{default:u(()=>l[63]||(l[63]=[c("取消")])),_:1}),s(f,{type:"primary",onClick:it,loading:pe.value},{default:u(()=>l[64]||(l[64]=[c(" 创建分享 ")])),_:1},8,["loading"])])]),default:u(()=>[s(me,{ref:"shareFormRef",model:F,"label-width":"100px"},{default:u(()=>[s(se,{label:"有效期"},{default:u(()=>[s(Ae,{modelValue:F.validType,"onUpdate:modelValue":l[18]||(l[18]=d=>F.validType=d),class:"w-full"},{default:u(()=>[s(te,{value:0,label:"1天"}),s(te,{value:1,label:"7天"}),s(te,{value:2,label:"30天"}),s(te,{value:3,label:"永久有效"})]),_:1},8,["modelValue"])]),_:1}),s(se,{label:"提取码"},{default:u(()=>[p("div",kl,[s(It,{modelValue:F.codeType,"onUpdate:modelValue":l[19]||(l[19]=d=>F.codeType=d),class:"mb-3"},{default:u(()=>[s(Ue,{label:0},{default:u(()=>l[61]||(l[61]=[c("自动生成")])),_:1}),s(Ue,{label:1},{default:u(()=>l[62]||(l[62]=[c("自定义")])),_:1})]),_:1},8,["modelValue"]),F.codeType===1?(y(),D(R,{key:0,modelValue:F.code,"onUpdate:modelValue":l[20]||(l[20]=d=>F.code=d),placeholder:"请输入5位提取码",maxlength:"5","show-word-limit":""},null,8,["modelValue"])):ie("",!0)])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},El=Vt(zl,[["__scopeId","data-v-9ca30017"]]);export{El as default};
