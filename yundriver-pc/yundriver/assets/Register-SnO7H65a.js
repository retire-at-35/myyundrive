import{_ as T}from"./logo-Dp76uQSX.js";import{r as z,m as B,g as q}from"./md5-DKd9LonJ.js";import{s as W}from"./email-Sb9TfbaC.js";import{_ as Z,a as j,r as d,o as F,c as G,b as l,d as a,w as r,e as m,f as H,g as v,t as O,h as K,E as c}from"./index-xsXBKXXp.js";const X={class:"auth-container"},Y={class:"auth-box"},J={class:"email-container"},Q={class:"verify-code-container"},ee={class:"verify-code-img"},ae=["src"],se={class:"operation-links"},le={class:"verify-dialog-content"},oe={class:"verify-input-container"},re={class:"verify-img"},te=["src"],ie={class:"dialog-footer"},ne={__name:"Register",setup(de){const L=K(),s=j({nickName:"",email:"",emailCode:"",password:"",confirmPassword:"",verifyCode:""}),_=d(60),V=d(!1),E=d("发送验证码");let k=null;const p=d(!1),f=d(""),y=d(""),C=d(""),g=d(!1),n={IP:{pattern:/^([1-9]|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])(\.(\\d|[1-9]\d|1\d{2}|2[0-4]\d|25[0-5])){3}$/,message:"IP地址"},POSITIVE_INTEGER:{pattern:/^[0-9]*[1-9][0-9]*$/,message:"正整数"},NUMBER_LETTER_UNDER_LINE:{pattern:/^\w+$/,message:"由数字、26个英文字母或者下划线组成的字符串"},EMAIL:{pattern:/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/,message:"邮箱"},PHONE:{pattern:/^(1[0-9])\d{9}$/,message:"手机号码"},COMMON:{pattern:/^[a-zA-Z0-9_\u4e00-\u9fa5]+$/,message:"数字，字母，中文，下划线"},PASSWORD:{pattern:/^(?=.*\d)(?=.*[a-zA-Z])[\da-zA-Z~!@#$%^&*_]{8,18}$/,message:"数字，字母，特殊字符 8 - 18位的组合"},ACCOUNT:{pattern:/^[a-zA-Z][a-zA-Z0-9_\u4e00-\u9fa5]{0,5}$/,message:"字母开头,由数字、英文字母或者下划线组成"},MONEY:{pattern:/^[0-9]+(\.[0-9]{1,2})?$/,message:"金额"}},U={nickName:[{required:!0,message:"请输入昵称",trigger:"blur"},{pattern:n.COMMON.pattern,message:n.COMMON.message,trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{pattern:n.EMAIL.pattern,message:"请输入正确的邮箱格式",trigger:"blur"}],emailCode:[{required:!0,message:"请输入邮箱验证码",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{pattern:n.PASSWORD.pattern,message:n.PASSWORD.message,trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(i,e,t)=>{e!==s.password?t(new Error("两次输入的密码不一致")):n.PASSWORD.pattern.test(e)?t():t(new Error(n.PASSWORD.message))},trigger:"blur"}],verifyCode:[{required:!0,message:"请输入验证码",trigger:"blur"},{pattern:n.NUMBER_LETTER_UNDER_LINE.pattern,message:n.NUMBER_LETTER_UNDER_LINE.message,trigger:"blur"}]},R=d(null),S=()=>{V.value=!0,k=setInterval(()=>{_.value>0?(_.value--,E.value=`${_.value}秒后重试`):(clearInterval(k),V.value=!1,E.value="发送验证码",_.value=60)},1e3)},h=async()=>{if(U.email[1],!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.email)){c.error("请输入正确的邮箱格式");return}f.value="",p.value=!0,N()},M=async()=>{if(!f.value){c.error("请输入验证码");return}try{g.value=!0,await W({email:s.email,checkCode:f.value,type:0}),p.value=!1,c.success("验证码已发送到邮箱"),S()}catch(i){N(),c.error(i.message||"发送失败")}finally{g.value=!1}},I=async()=>{R.value&&await R.value.validate(async i=>{if(i)try{await z({email:s.email,nickName:s.nickName,password:B(s.password),checkCode:s.verifyCode,emailCode:s.emailCode}),c.success("注册成功"),L.replace("/login")}catch(e){c.error(e.message||"注册失败"),b()}})},x=async i=>{try{const e=await q(i);i===1&&y.value?URL.revokeObjectURL(y.value):i===0&&C.value&&URL.revokeObjectURL(C.value);const t=new Blob([e],{type:"image/jpeg"});return URL.createObjectURL(t)}catch(e){return console.error("获取验证码失败:",e),""}},b=async()=>{y.value=await x(1)},N=async()=>{C.value=await x(0)};return F(()=>{b()}),(i,e)=>{const t=m("el-input"),u=m("el-form-item"),w=m("el-button"),P=m("router-link"),A=m("el-form"),$=m("el-card"),D=m("el-dialog");return H(),G("div",X,[l("div",Y,[a($,{class:"auth-card"},{default:r(()=>[e[11]||(e[11]=l("div",{class:"header"},[l("img",{src:T,class:"logo",alt:"logo"}),l("h2",{class:"title"},"用户注册"),l("p",{class:"subtitle"},"欢迎加入我们的云存储平台")],-1)),a(A,{model:s,rules:U,ref_key:"registerFormRef",ref:R,class:"auth-form"},{default:r(()=>[a(u,{prop:"nickName"},{default:r(()=>[a(t,{modelValue:s.nickName,"onUpdate:modelValue":e[0]||(e[0]=o=>s.nickName=o),placeholder:"请输入昵称","prefix-icon":"User"},null,8,["modelValue"])]),_:1}),a(u,{prop:"email"},{default:r(()=>[l("div",J,[a(t,{modelValue:s.email,"onUpdate:modelValue":e[1]||(e[1]=o=>s.email=o),placeholder:"请输入邮箱","prefix-icon":"Message",class:"email-input"},null,8,["modelValue"]),a(w,{type:"primary",disabled:V.value,onClick:h,style:{width:"120px",padding:"8px 0","font-size":"13px"}},{default:r(()=>[v(O(E.value),1)]),_:1},8,["disabled"])])]),_:1}),a(u,{prop:"emailCode"},{default:r(()=>[a(t,{modelValue:s.emailCode,"onUpdate:modelValue":e[2]||(e[2]=o=>s.emailCode=o),placeholder:"请输入邮箱验证码","prefix-icon":"Key"},null,8,["modelValue"])]),_:1}),a(u,{prop:"password"},{default:r(()=>[a(t,{modelValue:s.password,"onUpdate:modelValue":e[3]||(e[3]=o=>s.password=o),type:"password",placeholder:"请输入密码","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),a(u,{prop:"confirmPassword"},{default:r(()=>[a(t,{modelValue:s.confirmPassword,"onUpdate:modelValue":e[4]||(e[4]=o=>s.confirmPassword=o),type:"password",placeholder:"请确认密码","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1}),a(u,{prop:"verifyCode"},{default:r(()=>[l("div",Q,[a(t,{modelValue:s.verifyCode,"onUpdate:modelValue":e[5]||(e[5]=o=>s.verifyCode=o),placeholder:"请输入验证码",class:"verify-code-input"},null,8,["modelValue"]),l("div",ee,[l("img",{src:y.value,alt:"验证码",onClick:b},null,8,ae)])])]),_:1}),a(u,null,{default:r(()=>[a(w,{type:"primary",class:"submit-button",onClick:I},{default:r(()=>e[9]||(e[9]=[v(" 注册 ")])),_:1})]),_:1}),l("div",se,[a(P,{to:"/login",replace:""},{default:r(()=>e[10]||(e[10]=[v("返回登录")])),_:1})])]),_:1},8,["model"])]),_:1}),e[12]||(e[12]=l("div",{class:"footer"},[l("p")],-1))]),a(D,{modelValue:p.value,"onUpdate:modelValue":e[8]||(e[8]=o=>p.value=o),title:"安全验证",width:"360px",center:"","close-on-click-modal":!1,class:"verify-dialog"},{footer:r(()=>[l("div",ie,[a(w,{onClick:e[7]||(e[7]=o=>p.value=!1),size:"default"},{default:r(()=>e[13]||(e[13]=[v("取消")])),_:1}),a(w,{type:"primary",onClick:M,loading:g.value,disabled:g.value,size:"default"},{default:r(()=>[v(O(g.value?"发送中...":"确认"),1)]),_:1},8,["loading","disabled"])])]),default:r(()=>[l("div",le,[l("div",oe,[a(t,{modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=o=>f.value=o),placeholder:"请输入验证码",class:"verify-input"},null,8,["modelValue"]),l("div",re,[l("img",{src:C.value,alt:"验证码",onClick:N},null,8,te)])])])]),_:1},8,["modelValue"])])}}},fe=Z(ne,[["__scopeId","data-v-0c7f1f3f"]]);export{fe as default};
