import{_ as K,r as n,j as O,o as Q,c as R,b as i,d as t,w as l,a5 as W,x as X,E as k,e as o,a6 as Y,f as N,l as d,a7 as Z,a3 as ee,g as r,t as p,a8 as $,k as ae}from"./index-xsXBKXXp.js";import{f as x}from"./file-BhbL9qfw.js";import{l as te,u as le,a as se}from"./admin-C8agBfjW.js";const oe={class:"user-manage"},ne={class:"search-bar"},re={class:"table-container"},ie={class:"space-info"},ue={class:"pagination"},ce={class:"space-tip"},de={class:"dialog-footer"},pe={__name:"UserManage",setup(me){const g=n(!1),C=n([]),b=n(1),h=n(10),U=n(0),u=n({email:"",nickName:""}),y=n(!1),m=n({userId:"",space:1}),V=n(null),B=O(()=>"calc(100vh - 280px)"),_=async()=>{g.value=!0;try{const s=await te({page:b.value,pageSize:h.value,email:u.value.email,nickName:u.value.nickName});s.code===1&&(C.value=s.data.rows,U.value=s.data.total)}catch(s){console.error("获取用户列表失败:",s),k.error("获取用户列表失败")}finally{g.value=!1}},w=()=>{b.value=1,_()},I=()=>{u.value={email:"",nickName:""},w()},D=async s=>{const e=s.status===1?"禁用":"启用";try{await ae.confirm(`确定要${e}该用户吗？`,"提示",{type:"warning"}),g.value=!0,(await le(s.userId,s.status===1?0:1)).code===1&&(k.success(`${e}成功`),_())}catch(f){f!=="cancel"&&(console.error(`${e}用户失败:`,f),k.error(`${e}用户失败`))}finally{g.value=!1}},L=s=>{V.value=s,m.value={userId:s.userId,space:1},y.value=!0},M=async()=>{try{(await se(m.value.userId,m.value.space)).code===1&&(k.success("扩容成功"),y.value=!1,_())}catch(s){console.error("扩容失败:",s),k.error("扩容失败")}},T=s=>{h.value=s,_()},j=s=>{b.value=s,_()};return Q(()=>{_()}),(s,e)=>{const f=o("el-icon"),z=o("el-input"),v=o("el-button"),c=o("el-table-column"),E=o("el-tag"),F=o("el-table"),P=o("el-pagination"),G=o("el-input-number"),H=o("el-form-item"),q=o("el-form"),A=o("el-dialog"),J=Y("loading");return N(),R("div",oe,[i("div",ne,[t(z,{modelValue:u.value.email,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value.email=a),placeholder:"输入邮箱搜索",class:"search-input",clearable:""},{prefix:l(()=>[t(f,null,{default:l(()=>[t(d(Z))]),_:1})]),_:1},8,["modelValue"]),t(z,{modelValue:u.value.nickName,"onUpdate:modelValue":e[1]||(e[1]=a=>u.value.nickName=a),placeholder:"输入昵称搜索",class:"search-input",clearable:""},{prefix:l(()=>[t(f,null,{default:l(()=>[t(d(ee))]),_:1})]),_:1},8,["modelValue"]),t(v,{type:"primary",onClick:w},{default:l(()=>e[7]||(e[7]=[r("搜索")])),_:1}),t(v,{onClick:I},{default:l(()=>e[8]||(e[8]=[r("重置")])),_:1})]),i("div",re,[W((N(),X(F,{data:C.value,style:{width:"100%"},height:B.value},{default:l(()=>[t(c,{prop:"nickName",label:"用户名"}),t(c,{prop:"email",label:"邮箱"}),t(c,{label:"存储空间",width:"200"},{default:l(({row:a})=>[i("div",ie,[i("span",null,p(d(x)(a.userSpace))+"/"+p(d(x)(a.totalSpace)),1),t(v,{type:"primary",link:"",onClick:S=>L(a)},{default:l(()=>e[9]||(e[9]=[r(" 扩容 ")])),_:2},1032,["onClick"])])]),_:1}),t(c,{prop:"joinTime",label:"注册时间",width:"180"},{default:l(({row:a})=>[r(p(d($)(a.joinTime)),1)]),_:1}),t(c,{prop:"lastLoginTime",label:"最后登录",width:"180"},{default:l(({row:a})=>[r(p(d($)(a.lastLoginTime)),1)]),_:1}),t(c,{prop:"status",label:"状态",width:"100"},{default:l(({row:a})=>[t(E,{type:a.status===1?"success":"danger"},{default:l(()=>[r(p(a.status===1?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(c,{label:"操作",width:"120",fixed:"right"},{default:l(({row:a})=>[t(v,{type:a.status===1?"danger":"primary",link:"",onClick:S=>D(a)},{default:l(()=>[r(p(a.status===1?"禁用":"启用"),1)]),_:2},1032,["type","onClick"])]),_:1})]),_:1},8,["data","height"])),[[J,g.value]])]),i("div",ue,[t(P,{"current-page":b.value,"onUpdate:currentPage":e[2]||(e[2]=a=>b.value=a),"page-size":h.value,"onUpdate:pageSize":e[3]||(e[3]=a=>h.value=a),total:U.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:T,onCurrentChange:j},null,8,["current-page","page-size","total"])]),t(A,{modelValue:y.value,"onUpdate:modelValue":e[6]||(e[6]=a=>y.value=a),title:"扩容存储空间",width:"400px"},{footer:l(()=>[i("span",de,[t(v,{onClick:e[5]||(e[5]=a=>y.value=!1)},{default:l(()=>e[11]||(e[11]=[r("取消")])),_:1}),t(v,{type:"primary",onClick:M},{default:l(()=>e[12]||(e[12]=[r(" 确认 ")])),_:1})])]),default:l(()=>[t(q,{model:m.value,"label-width":"100px"},{default:l(()=>{var a;return[t(H,{label:"扩容空间"},{default:l(()=>[t(G,{modelValue:m.value.space,"onUpdate:modelValue":e[4]||(e[4]=S=>m.value.space=S),min:1,max:1024},null,8,["modelValue"]),e[10]||(e[10]=i("span",{class:"unit-text"},"GB",-1))]),_:1}),i("div",ce,"当前空间："+p(d(x)(((a=V.value)==null?void 0:a.totalSpace)||0)),1)]}),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ge=K(pe,[["__scopeId","data-v-47468cea"]]);export{ge as default};
